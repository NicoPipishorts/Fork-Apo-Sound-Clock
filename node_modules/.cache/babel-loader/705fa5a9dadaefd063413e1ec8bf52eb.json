{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";// == IMPORT NPM\nimport axios from\"axios\";import FormData from\"form-data\";// == IMPORT ASSETS\nimport{CREATE_USER,getUpdatedUser,GET_UPDATED_USER,GET_USERS_LIST,saveUpdatedUser,setErrorMailCreate,setUsersList,UPDATE_PROFILE}from'../actions/user';import{setProgress,setErrorCode}from'../actions/musics';var usersApi=function usersApi(store){return function(next){return function(action){var formData=new FormData();var _store$getState=store.getState(),_store$getState$users=_store$getState.users,name=_store$getState$users.name,email=_store$getState$users.email,password=_store$getState$users.password,picture=_store$getState$users.picture,description=_store$getState$users.description,label=_store$getState$users.label,user=_store$getState$users.user;if(email!==''){formData.append('email',email);}if(description!==''){formData.append('description',description);}if(password!==''){formData.append('password',password);}if(label!==''){formData.append('label',label);}if(picture!==''){formData.append('picture',picture);}var config={headers:{\"Content-type\":\"multipart/form-data\"},onUploadProgress:function onUploadProgress(data){//Set the progress value to show the progress bar\nstore.dispatch(setProgress(Math.round(100*data.loaded/data.total)));}};var baseURL='http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';switch(action.type){case CREATE_USER:axios.post(\"\".concat(baseURL,\"/api/user/new\"),{email:email,name:name,password:password},config).then(function(response){console.log('Le data a était envoyé, all is good.',response);store.dispatch(setErrorMailCreate(response.status));}).catch(function(error){store.dispatch(setErrorMailCreate(error.response.data.error));console.log(\"je suis la reponse.status\",error.response.data.error);console.log('error nul',error);});break;case GET_USERS_LIST:axios.get(\"\".concat(baseURL,\"/api/users/rand\")).then(function(response){store.dispatch(setUsersList(response.data));}).catch(function(error){// eslint-disable-next-line no-console\nconsole.log('error',error);});break;case UPDATE_PROFILE:console.log('je récupére bien les info dans le middleware user : ');var _iterator=_createForOfIteratorHelper(formData.entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var pair=_step.value;console.log(pair[0]+' > '+pair[1]);}}catch(err){_iterator.e(err);}finally{_iterator.f();}axios.post(\"\".concat(baseURL,\"/api/user/edit/\").concat(user.id),formData,config).then(function(response){// console.log('Le user a était updaté, all is good.', response.status);\nvar data={slug:user.slug,status:response.status};store.dispatch(getUpdatedUser(data));}).catch(function(error){// eslint-disable-next-line no-console\nstore.dispatch(setErrorCode(error.response.data.error));//* console.log(\"je suis la reponse.status\",error.response.data.error); \nconsole.log('Error while updating user data to the database : ',error);});break;case GET_UPDATED_USER:axios.get(\"\".concat(baseURL,\"/api/user/\").concat(action.slug)).then(function(response){var data={user:response.data,status:action.status};store.dispatch(saveUpdatedUser(data));}).catch(function(error){console.log('Error while saving the updates for the user : ',error);});break;default:next(action);}};};};export default usersApi;","map":{"version":3,"sources":["/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/src/middlewares/usersApi.js"],"names":["axios","FormData","CREATE_USER","getUpdatedUser","GET_UPDATED_USER","GET_USERS_LIST","saveUpdatedUser","setErrorMailCreate","setUsersList","UPDATE_PROFILE","setProgress","setErrorCode","usersApi","store","next","action","formData","getState","users","name","email","password","picture","description","label","user","append","config","headers","onUploadProgress","data","dispatch","Math","round","loaded","total","baseURL","type","post","then","response","console","log","status","catch","error","get","entries","pair","id","slug"],"mappings":"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","sourcesContent":["// == IMPORT NPM\nimport axios from \"axios\";\nimport FormData from \"form-data\";\n\n// == IMPORT ASSETS\nimport {\n  CREATE_USER,\n  getUpdatedUser,\n  GET_UPDATED_USER,\n  GET_USERS_LIST, \n  saveUpdatedUser, \n  setErrorMailCreate, \n  setUsersList,\n  UPDATE_PROFILE,\n} from '../actions/user';\n\nimport {  \n    setProgress,\n    setErrorCode\n} from '../actions/musics';\n\n\nconst usersApi = (store) => (next) => (action) =>{\n      \n  const formData = new FormData();\n\n  let { users : {\n    name,\n    email,\n    password,\n    picture,\n    description,\n    label,\n    user\n  }} = store.getState();\n\n  if(email !== '') {\n    formData.append('email', email);\n  }\n\n  if(description !== ''){\n    formData.append('description', description);\n  }\n\n  if(password !== ''){\n    formData.append('password', password);\n  }\n\n  if(label !== '') {\n    formData.append('label', label);\n  }\n\n  if(picture !== '') {\n    formData.append('picture', picture);\n  }\n\n  const config = {\n    headers: {\n      \"Content-type\": \"multipart/form-data\"\n    },\n    onUploadProgress: data => {\n      //Set the progress value to show the progress bar\n      store.dispatch(setProgress(Math.round((100 * data.loaded) / data.total)))\n      \n    }\n\n  };\n\n  const baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';\n\n  switch (action.type) {\n   \n    case CREATE_USER:\n      axios.post(`${baseURL}/api/user/new` , {\n        email,\n        name,\n        password  \n      }, config\n        ).then((response) => {\n          console.log('Le data a était envoyé, all is good.',response);\n          store.dispatch(setErrorMailCreate(response.status))\n        })\n        .catch((error) => {\n          store.dispatch(setErrorMailCreate(error.response.data.error))\n          console.log(\"je suis la reponse.status\",error.response.data.error);\n          console.log('error nul', error);\n        });\n      break;\n\n    case GET_USERS_LIST: \n      axios.get(`${baseURL}/api/users/rand`)\n      .then((response) => {\n          store.dispatch(setUsersList(response.data));\n        })\n      .catch((error) => {\n          // eslint-disable-next-line no-console\n          console.log('error', error);\n        });\n      break;\n\n    case UPDATE_PROFILE:\n        console.log('je récupére bien les info dans le middleware user : ');\n        for (var pair of formData.entries()) {\n            console.log(pair[0]+ ' > ' + pair[1]); \n        }\n        \n        axios.post(`${baseURL}/api/user/edit/${user.id}`,\n        formData, \n        config\n          ).then((response) => {\n            // console.log('Le user a était updaté, all is good.', response.status);\n            const data = {slug: user.slug, status: response.status}\n            store.dispatch(getUpdatedUser(data));\n          })\n          .catch((error) => {\n            // eslint-disable-next-line no-console\n            store.dispatch(setErrorCode(error.response.data.error))\n            //* console.log(\"je suis la reponse.status\",error.response.data.error); \n            console.log('Error while updating user data to the database : ', error);\n          }); \n        \n      break;\n\n      case GET_UPDATED_USER: \n        axios.get(`${baseURL}/api/user/${action.slug}`)\n        .then((response) => {\n            const data = {user: response.data, status: action.status}\n            store.dispatch(saveUpdatedUser(data));\n          })\n        .catch((error) => {\n            console.log('Error while saving the updates for the user : ', error);\n          });\n        break;\n    default:\n    next(action);   \n  }\n};\nexport default usersApi;"]},"metadata":{},"sourceType":"module"}