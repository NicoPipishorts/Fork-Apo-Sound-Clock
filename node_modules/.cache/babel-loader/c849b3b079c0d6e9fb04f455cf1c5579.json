{"ast":null,"code":"// == IMPORT NPM\nimport axios from \"axios\";\nimport FormData from \"form-data\"; // == IMPORT ASSETS\n\nimport { CREATE_USER, getUpdatedUser, GET_UPDATED_USER, GET_USERS_LIST, saveUpdatedUser, setErrorMailCreate, setUsersList, UPDATE_PROFILE } from '../actions/user';\nimport { setProgress, setErrorCode } from '../actions/musics';\n\nconst usersApi = store => next => action => {\n  const formData = new FormData();\n  let {\n    users: {\n      name,\n      email,\n      password,\n      picture,\n      description,\n      label,\n      user\n    }\n  } = store.getState();\n\n  if (email !== '') {\n    formData.append('email', email);\n  }\n\n  if (description !== '') {\n    formData.append('description', description);\n  }\n\n  if (password !== '') {\n    formData.append('password', password);\n  }\n\n  if (label !== '') {\n    formData.append('label', label);\n  }\n\n  if (picture !== '') {\n    formData.append('picture', picture);\n  }\n\n  const config = {\n    headers: {\n      \"Content-type\": \"multipart/form-data\"\n    },\n    onUploadProgress: data => {\n      //Set the progress value to show the progress bar\n      store.dispatch(setProgress(Math.round(100 * data.loaded / data.total)));\n    }\n  };\n  const baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';\n\n  switch (action.type) {\n    case CREATE_USER:\n      axios.post(`${baseURL}/api/user/new`, {\n        email,\n        name,\n        password\n      }, config).then(response => {\n        console.log('Le data a était envoyé, all is good.', response);\n        store.dispatch(setErrorMailCreate(response.status));\n      }).catch(error => {\n        store.dispatch(setErrorMailCreate(error.response.data.error));\n        console.log(\"je suis la reponse.status\", error.response.data.error);\n        console.log('error nul', error);\n      });\n      break;\n\n    case GET_USERS_LIST:\n      axios.get(`${baseURL}/api/users/rand`).then(response => {\n        store.dispatch(setUsersList(response.data));\n      }).catch(error => {\n        // eslint-disable-next-line no-console\n        console.log('error', error);\n      });\n      break;\n\n    case UPDATE_PROFILE:\n      console.log('je récupére bien les info dans le middleware user : ');\n\n      for (var pair of formData.entries()) {\n        console.log(pair[0] + ' > ' + pair[1]);\n      }\n\n      axios.post(`${baseURL}/api/user/edit/${user.id}`, formData, config).then(response => {\n        // console.log('Le user a était updaté, all is good.', response.status);\n        const data = {\n          slug: user.slug,\n          status: response.status\n        };\n        store.dispatch(getUpdatedUser(data));\n      }).catch(error => {\n        // eslint-disable-next-line no-console\n        store.dispatch(setErrorCode(error.response.data.error)); //* console.log(\"je suis la reponse.status\",error.response.data.error); \n\n        console.log('Error while updating user data to the database : ', error);\n      });\n      break;\n\n    case GET_UPDATED_USER:\n      axios.get(`${baseURL}/api/user/${action.slug}`).then(response => {\n        const data = {\n          user: response.data,\n          status: action.status\n        };\n        store.dispatch(saveUpdatedUser(data));\n      }).catch(error => {\n        console.log('Error while saving the updates for the user : ', error);\n      });\n      break;\n\n    default:\n      next(action);\n  }\n};\n\nexport default usersApi;","map":{"version":3,"sources":["/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/src/middlewares/usersApi.js"],"names":["axios","FormData","CREATE_USER","getUpdatedUser","GET_UPDATED_USER","GET_USERS_LIST","saveUpdatedUser","setErrorMailCreate","setUsersList","UPDATE_PROFILE","setProgress","setErrorCode","usersApi","store","next","action","formData","users","name","email","password","picture","description","label","user","getState","append","config","headers","onUploadProgress","data","dispatch","Math","round","loaded","total","baseURL","type","post","then","response","console","log","status","catch","error","get","pair","entries","id","slug"],"mappings":"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","sourcesContent":["// == IMPORT NPM\nimport axios from \"axios\";\nimport FormData from \"form-data\";\n\n// == IMPORT ASSETS\nimport {\n  CREATE_USER,\n  getUpdatedUser,\n  GET_UPDATED_USER,\n  GET_USERS_LIST, \n  saveUpdatedUser, \n  setErrorMailCreate, \n  setUsersList,\n  UPDATE_PROFILE,\n} from '../actions/user';\n\nimport {  \n    setProgress,\n    setErrorCode\n} from '../actions/musics';\n\n\nconst usersApi = (store) => (next) => (action) =>{\n      \n  const formData = new FormData();\n\n  let { users : {\n    name,\n    email,\n    password,\n    picture,\n    description,\n    label,\n    user\n  }} = store.getState();\n\n  if(email !== '') {\n    formData.append('email', email);\n  }\n\n  if(description !== ''){\n    formData.append('description', description);\n  }\n\n  if(password !== ''){\n    formData.append('password', password);\n  }\n\n  if(label !== '') {\n    formData.append('label', label);\n  }\n\n  if(picture !== '') {\n    formData.append('picture', picture);\n  }\n\n  const config = {\n    headers: {\n      \"Content-type\": \"multipart/form-data\"\n    },\n    onUploadProgress: data => {\n      //Set the progress value to show the progress bar\n      store.dispatch(setProgress(Math.round((100 * data.loaded) / data.total)))\n      \n    }\n\n  };\n\n  const baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';\n\n  switch (action.type) {\n   \n    case CREATE_USER:\n      axios.post(`${baseURL}/api/user/new` , {\n        email,\n        name,\n        password  \n      }, config\n        ).then((response) => {\n          console.log('Le data a était envoyé, all is good.',response);\n          store.dispatch(setErrorMailCreate(response.status))\n        })\n        .catch((error) => {\n          store.dispatch(setErrorMailCreate(error.response.data.error))\n          console.log(\"je suis la reponse.status\",error.response.data.error);\n          console.log('error nul', error);\n        });\n      break;\n\n    case GET_USERS_LIST: \n      axios.get(`${baseURL}/api/users/rand`)\n      .then((response) => {\n          store.dispatch(setUsersList(response.data));\n        })\n      .catch((error) => {\n          // eslint-disable-next-line no-console\n          console.log('error', error);\n        });\n      break;\n\n    case UPDATE_PROFILE:\n        console.log('je récupére bien les info dans le middleware user : ');\n        for (var pair of formData.entries()) {\n            console.log(pair[0]+ ' > ' + pair[1]); \n        }\n        \n        axios.post(`${baseURL}/api/user/edit/${user.id}`,\n        formData, \n        config\n          ).then((response) => {\n            // console.log('Le user a était updaté, all is good.', response.status);\n            const data = {slug: user.slug, status: response.status}\n            store.dispatch(getUpdatedUser(data));\n          })\n          .catch((error) => {\n            // eslint-disable-next-line no-console\n            store.dispatch(setErrorCode(error.response.data.error))\n            //* console.log(\"je suis la reponse.status\",error.response.data.error); \n            console.log('Error while updating user data to the database : ', error);\n          }); \n        \n      break;\n\n      case GET_UPDATED_USER: \n        axios.get(`${baseURL}/api/user/${action.slug}`)\n        .then((response) => {\n            const data = {user: response.data, status: action.status}\n            store.dispatch(saveUpdatedUser(data));\n          })\n        .catch((error) => {\n            console.log('Error while saving the updates for the user : ', error);\n          });\n        break;\n    default:\n    next(action);   \n  }\n};\nexport default usersApi;"]},"metadata":{},"sourceType":"module"}