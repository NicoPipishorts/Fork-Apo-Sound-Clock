{"ast":null,"code":"// == IMPORT NPM\nimport axios from 'axios'; // == IMPORT ASSETS\n\nimport { LOGIN, saveUser } from '../actions/user'; // on crée une instance d'axios\n// on va pouvoir se configurer cette instance\n// avant de s'en servir\n\nconst baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';\n\nconst authMiddleWare = store => next => action => {\n  switch (action.type) {\n    case LOGIN:\n      {\n        const {\n          users: {\n            username,\n            password\n          }\n        } = store.getState(); // Send request with User Login for JWT Token\n\n        axios.post(`${baseURL}/api/login_check`, {\n          username,\n          password\n        }).then(response => {\n          // console.log(response);\n          localStorage.setItem('itemName', response.data.token);\n          store.dispatch(saveUser(response.data));\n        }).catch(() => console.log('error'));\n      }\n      break;\n\n    default:\n      next(action);\n\n    /*\n    case GET_USER: {\n       const { user: { usnername, password } } = store.getState();\n       axiosInstance\n        .get(\n          '/api/test',\n          // on transmet notre token dans le header de la requête HTTP\n          // Ici on s'appuie que le mécanisme de configuration d'axios\n          {\n            usnername,\n            password,\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        )\n        .then(\n          (response) => {\n          // une fois les favoris obtenus, on demande leur sauvegarde dans le state\n            store.dispatch(saveFavorites(response.data.favorites));\n          },\n        ).catch(\n          () => console.log('error recup favoris'),\n        );\n      next(action);\n      break;\n    }\n    */\n\n    /*    case LOGOUT:\n         // au logout, on supprime le token de l'instance\n         axiosInstance.defaults.headers.common.Authorization = null;\n         next(action);\n         break;\n       default:\n         next(action); */\n  }\n};\n\nexport default authMiddleWare;","map":{"version":3,"sources":["/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/src/middlewares/auth.js"],"names":["axios","LOGIN","saveUser","baseURL","authMiddleWare","store","next","action","type","users","username","password","getState","post","then","response","localStorage","setItem","data","token","dispatch","catch","console","log"],"mappings":"AAAA;AACA,OAAOA,KAAP,MAAkB,OAAlB,C,CAEA;;AACA,SACEC,KADF,EACSC,QADT,QAEO,iBAFP,C,CAIA;AACA;AACA;;AAEA,MAAMC,OAAO,GAAG,uEAAhB;;AAEA,MAAMC,cAAc,GAAIC,KAAD,IAAYC,IAAD,IAAWC,MAAD,IAAY;AACtD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKP,KAAL;AAAY;AACV,cAAM;AAAEQ,UAAAA,KAAK,EAAE;AAAEC,YAAAA,QAAF;AAAYC,YAAAA;AAAZ;AAAT,YAAoCN,KAAK,CAACO,QAAN,EAA1C,CADU,CAGV;;AACAZ,QAAAA,KAAK,CAACa,IAAN,CAAY,GAAEV,OAAQ,kBAAtB,EAAyC;AACvCO,UAAAA,QADuC;AAEvCC,UAAAA;AAFuC,SAAzC,EAGGG,IAHH,CAIGC,QAAD,IAAc;AACZ;AACAC,UAAAA,YAAY,CAACC,OAAb,CAAqB,UAArB,EAAiCF,QAAQ,CAACG,IAAT,CAAcC,KAA/C;AACAd,UAAAA,KAAK,CAACe,QAAN,CAAelB,QAAQ,CAACa,QAAQ,CAACG,IAAV,CAAvB;AACD,SARH,EASEG,KATF,CAUE,MAAMC,OAAO,CAACC,GAAR,CAAY,OAAZ,CAVR;AAYD;AACD;;AACA;AACAjB,MAAAA,IAAI,CAACC,MAAD,CAAJ;;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGC;AACD;AACA;AACA;AACA;AACA;AACA;AAzDE;AA6DD,CA9DD;;AAgEA,eAAeH,cAAf","sourcesContent":["// == IMPORT NPM\nimport axios from 'axios';\n\n// == IMPORT ASSETS\nimport {\n  LOGIN, saveUser,\n} from '../actions/user';\n\n// on crée une instance d'axios\n// on va pouvoir se configurer cette instance\n// avant de s'en servir\n\nconst baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public'\n\nconst authMiddleWare = (store) => (next) => (action) => {\n  switch (action.type) {\n    case LOGIN: {\n      const { users: { username, password } } = store.getState();\n\n      // Send request with User Login for JWT Token\n      axios.post(`${baseURL}/api/login_check`, {\n        username,\n        password,\n      }).then(\n        (response) => {\n          // console.log(response);\n          localStorage.setItem('itemName', response.data.token)\n          store.dispatch(saveUser(response.data));          \n        },\n      ).catch(\n        () => console.log('error'),\n      );\n    }\n    break;\n    default:\n    next(action);\n    /*\n    case GET_USER: {\n\n      const { user: { usnername, password } } = store.getState();\n\n      axiosInstance\n        .get(\n          '/api/test',\n          // on transmet notre token dans le header de la requête HTTP\n          // Ici on s'appuie que le mécanisme de configuration d'axios\n          {\n            usnername,\n            password,\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        )\n        .then(\n          (response) => {\n          // une fois les favoris obtenus, on demande leur sauvegarde dans le state\n            store.dispatch(saveFavorites(response.data.favorites));\n          },\n        ).catch(\n          () => console.log('error recup favoris'),\n        );\n      next(action);\n      break;\n    }\n    */\n /*    case LOGOUT:\n      // au logout, on supprime le token de l'instance\n      axiosInstance.defaults.headers.common.Authorization = null;\n      next(action);\n      break;\n    default:\n      next(action); */\n\n\n  }\n};\n\nexport default authMiddleWare;\n"]},"metadata":{},"sourceType":"module"}