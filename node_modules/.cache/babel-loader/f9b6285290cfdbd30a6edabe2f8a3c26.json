{"ast":null,"code":"// == IMPORT NPM\nimport axios from\"axios\";import FormData from\"form-data\";// == IMPORT ASSETS\nimport{GET_MUSICS_LIST,setMusicsList,SEND_MUSIC,resetMusicState,setProgress,setErrorCode}from'../actions/musics';var musicApi=function musicApi(store){return function(next){return function(action){//const picture = \"test-picture\";\n//const file = \"test-file\";\nvar _store$getState=store.getState(),_store$getState$music=_store$getState.musics,title=_store$getState$music.title,file=_store$getState$music.file,picture=_store$getState$music.picture,description=_store$getState$music.description,releaseDate=_store$getState$music.releaseDate;var _store$getState2=store.getState(),user=_store$getState2.users.user;var formData=new FormData();formData.append('title',title);formData.append('user',user.id);formData.append('file',file);formData.append('picture',picture);formData.append('releasedate','03-03-2022');//formData.append('releasedate', releaseDate);\nformData.append('description',description);var config={headers:{\"Content-type\":\"multipart/form-data\"},onUploadProgress:function onUploadProgress(data){//Set the progress value to show the progress bar\nstore.dispatch(setProgress(Math.round(100*data.loaded/data.total)));}};var baseURL='http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';switch(action.type){case GET_MUSICS_LIST:axios.get(\"\".concat(baseURL,\"/api/musics/top10/like\")).then(function(response){//console.log(response);\nstore.dispatch(setMusicsList(response.data));}).catch(function(error){// eslint-disable-next-line no-console\nconsole.log('error',error);});break;case SEND_MUSIC:axios.post(\"\".concat(baseURL,\"/api/musics\"),formData,config).then(function(response){// console.log('Le data a était envoyé, all is good.',response);\n// console.log(\"je suis la reponse.status\",response.status);\nstore.dispatch(resetMusicState(response.status));})/* .then((response) => {\n        console.log(\"je suis la reponse.status\",response.status);\n      }); */.catch(function(error){// eslint-disable-next-line no-console\nstore.dispatch(setErrorCode(error.response.data.error));/* console.log(\"je suis la reponse.status\",error.response.data.error); */console.log('Music Upload Error',error);});break;default:next(action);}};};};export default musicApi;","map":{"version":3,"sources":["/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/src/middlewares/musicApi.js"],"names":["axios","FormData","GET_MUSICS_LIST","setMusicsList","SEND_MUSIC","resetMusicState","setProgress","setErrorCode","musicApi","store","next","action","getState","musics","title","file","picture","description","releaseDate","user","users","formData","append","id","config","headers","onUploadProgress","data","dispatch","Math","round","loaded","total","baseURL","type","get","then","response","catch","error","console","log","post","status"],"mappings":"AAAA;AACA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,WAArB,CAEA;AACA,OACIC,eADJ,CAEIC,aAFJ,CAGIC,UAHJ,CAIIC,eAJJ,CAKIC,WALJ,CAMIC,YANJ,KAOO,mBAPP,CASA,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,KAAD,QAAW,UAACC,IAAD,QAAU,UAACC,MAAD,CAAW,CAE/C;AACA;AACA,oBAMQF,KAAK,CAACG,QAAN,EANR,uCAAQC,MAAR,CACEC,KADF,uBACEA,KADF,CAEEC,IAFF,uBAEEA,IAFF,CAGEC,OAHF,uBAGEA,OAHF,CAIEC,WAJF,uBAIEA,WAJF,CAKEC,WALF,uBAKEA,WALF,CAQE,qBAA4BT,KAAK,CAACG,QAAN,EAA5B,CAAkBO,IAAlB,kBAAQC,KAAR,CAAkBD,IAAlB,CAEA,GAAME,CAAAA,QAAQ,CAAG,GAAIpB,CAAAA,QAAJ,EAAjB,CACAoB,QAAQ,CAACC,MAAT,CAAgB,OAAhB,CAAyBR,KAAzB,EACAO,QAAQ,CAACC,MAAT,CAAgB,MAAhB,CAAwBH,IAAI,CAACI,EAA7B,EACAF,QAAQ,CAACC,MAAT,CAAgB,MAAhB,CAAwBP,IAAxB,EACAM,QAAQ,CAACC,MAAT,CAAgB,SAAhB,CAA2BN,OAA3B,EACAK,QAAQ,CAACC,MAAT,CAAgB,aAAhB,CAA+B,YAA/B,EACA;AACAD,QAAQ,CAACC,MAAT,CAAgB,aAAhB,CAA+BL,WAA/B,EAEA,GAAMO,CAAAA,MAAM,CAAG,CACbC,OAAO,CAAE,CACP,eAAgB,qBADT,CADI,CAIbC,gBAAgB,CAAE,0BAAAC,IAAI,CAAI,CAExB;AACAlB,KAAK,CAACmB,QAAN,CAAetB,WAAW,CAACuB,IAAI,CAACC,KAAL,CAAY,IAAMH,IAAI,CAACI,MAAZ,CAAsBJ,IAAI,CAACK,KAAtC,CAAD,CAA1B,EAED,CATY,CAAf,CAaF,GAAMC,CAAAA,OAAO,CAAG,uEAAhB,CAEA,OAAQtB,MAAM,CAACuB,IAAf,EACE,IAAKhC,CAAAA,eAAL,CACEF,KAAK,CAACmC,GAAN,WAAaF,OAAb,4BACCG,IADD,CACM,SAACC,QAAD,CAAc,CAChB;AACA5B,KAAK,CAACmB,QAAN,CAAezB,aAAa,CAACkC,QAAQ,CAACV,IAAV,CAA5B,EACD,CAJH,EAKCW,KALD,CAKO,SAACC,KAAD,CAAW,CACd;AACAC,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAqBF,KAArB,EACD,CARH,EASA,MAEF,IAAKnC,CAAAA,UAAL,CACEJ,KAAK,CAAC0C,IAAN,WACGT,OADH,gBAEAZ,QAFA,CAGAG,MAHA,EAIEY,IAJF,CAIO,SAACC,QAAD,CAAc,CACjB;AACA;AACA5B,KAAK,CAACmB,QAAN,CAAevB,eAAe,CAACgC,QAAQ,CAACM,MAAV,CAA9B,EACD,CARH,CASA;AACN;AACA,YAXM,CAYCL,KAZD,CAYO,SAACC,KAAD,CAAW,CAChB;AACA9B,KAAK,CAACmB,QAAN,CAAerB,YAAY,CAACgC,KAAK,CAACF,QAAN,CAAeV,IAAf,CAAoBY,KAArB,CAA3B,EACA,yEACAC,OAAO,CAACC,GAAR,CAAY,oBAAZ,CAAkCF,KAAlC,EACD,CAjBD,EAkBA,MACF,QACA7B,IAAI,CAACC,MAAD,CAAJ,CAlCF,CAoCD,CA1E2B,EAAX,EAAjB,CA2EA,cAAeH,CAAAA,QAAf","sourcesContent":["// == IMPORT NPM\nimport axios from \"axios\";\nimport FormData from \"form-data\";\n\n// == IMPORT ASSETS\nimport {\n    GET_MUSICS_LIST, \n    setMusicsList, \n    SEND_MUSIC,\n    resetMusicState,\n    setProgress,\n    setErrorCode\n} from '../actions/musics';\n\nconst musicApi = (store) => (next) => (action) =>{\n\n  //const picture = \"test-picture\";\n  //const file = \"test-file\";\n  const { musics: { \n    title, \n    file,\n    picture,\n    description,\n    releaseDate,\n    } } = store.getState();\n\n    const { users : { user }} = store.getState();\n      \n    const formData = new FormData();\n    formData.append('title', title);\n    formData.append('user', user.id);\n    formData.append('file', file);\n    formData.append('picture', picture);\n    formData.append('releasedate', '03-03-2022');\n    //formData.append('releasedate', releaseDate);\n    formData.append('description', description);\n\n    const config = {\n      headers: {\n        \"Content-type\": \"multipart/form-data\"\n      },\n      onUploadProgress: data => {\n        \n        //Set the progress value to show the progress bar\n        store.dispatch(setProgress(Math.round((100 * data.loaded) / data.total)))\n        \n      }\n\n    };\n\n  const baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';\n\n  switch (action.type) {\n    case GET_MUSICS_LIST: \n      axios.get(`${baseURL}/api/musics/top10/like`)\n      .then((response) => {\n          //console.log(response);\n          store.dispatch(setMusicsList(response.data));\n        })\n      .catch((error) => {\n          // eslint-disable-next-line no-console\n          console.log('error', error);\n        }); \n      break;\n\n    case SEND_MUSIC: \n      axios.post(\n      `${baseURL}/api/musics`,\n      formData, \n      config\n      ).then((response) => {        \n          // console.log('Le data a était envoyé, all is good.',response);\n          // console.log(\"je suis la reponse.status\",response.status);\n          store.dispatch(resetMusicState(response.status));\n        })\n      /* .then((response) => {\n        console.log(\"je suis la reponse.status\",response.status);\n      }); */\n      .catch((error) => {\n        // eslint-disable-next-line no-console\n        store.dispatch(setErrorCode(error.response.data.error))\n        /* console.log(\"je suis la reponse.status\",error.response.data.error); */\n        console.log('Music Upload Error', error);\n      }); \n      break;\n    default:\n    next(action);   \n  }\n};\nexport default musicApi;"]},"metadata":{},"sourceType":"module"}