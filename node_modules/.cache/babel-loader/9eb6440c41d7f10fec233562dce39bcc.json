{"ast":null,"code":"// == IMPORT NPM\nimport axios from'axios';// == IMPORT ASSETS\nimport{LOGIN,GET_USER_WITH_SLUG,saveUserWithSlug,GET_LOGGED_USER,saveLoggedUser,getLoggedUser}from'../actions/user';// on crée une instance d'axios\n// on va pouvoir se configurer cette instance\n// avant de s'en servir\nvar baseURL='http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public';var authMiddleWare=function authMiddleWare(store){return function(next){return function(action){switch(action.type){case LOGIN:{var _store$getState=store.getState(),_store$getState$users=_store$getState.users,email=_store$getState$users.email,password=_store$getState$users.password;var username=email;// console.log('etape : 3 je passe par le middleware login je vais au get user : ', name, password);\n// Send request with User Login for JWT Token\naxios.post(\"\".concat(baseURL,\"/api/login_check\"),{username:username,password:password}).then(function(response){localStorage.setItem('userToken',response.data.token);console.log('etape : 4 réponse positive je passe au reducer');var token=response.data.token;var base64Url=token.split('.')[1];var base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');var jsonPayload=decodeURIComponent(atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));var payload=JSON.parse(jsonPayload);store.dispatch(getLoggedUser(payload.slug));}).catch(function(error){return console.log('Login error : ',error);});}break;case GET_USER_WITH_SLUG:// console.log('Get User With slug prop passed to middleware ',action.slug);\n// console.log('voici la route de l\\'api : ', `${baseURL}/api/user/${action.slug}`);\naxios.get(\"\".concat(baseURL,\"/api/user/\").concat(action.slug)).then(function(response){//console.log('je suis le response du get user with slug', response);\nstore.dispatch(saveUserWithSlug(response.data));}).catch(function(){return console.log('Get User By Slug Error');});break;//* Action Type to recover logged user from Token\ncase GET_LOGGED_USER:// console.log('voici la route de l\\'api pour get logged user: ', `${baseURL}/api/user/${action.slug}`);\naxios.get(\"\".concat(baseURL,\"/api/user/\").concat(action.slug)).then(function(response){//console.log('je suis le response du get user with slug', response.data);\nstore.dispatch(saveLoggedUser(response.data));}).catch(function(error){return console.log('Get Logged User by Slug : error : ',error);});break;default:next(action);}};};};export default authMiddleWare;","map":{"version":3,"sources":["/Users/nicolaspisar/Sites/_OClock/react/Apo/projet-9-sound-clock-front/src/middlewares/auth.js"],"names":["axios","LOGIN","GET_USER_WITH_SLUG","saveUserWithSlug","GET_LOGGED_USER","saveLoggedUser","getLoggedUser","baseURL","authMiddleWare","store","next","action","type","getState","users","email","password","username","post","then","response","localStorage","setItem","data","token","console","log","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","payload","JSON","parse","dispatch","slug","catch","error","get"],"mappings":"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","sourcesContent":["// == IMPORT NPM\nimport axios from 'axios';\n\n// == IMPORT ASSETS\nimport {\n  LOGIN, \n  GET_USER_WITH_SLUG,\n  saveUserWithSlug,\n  GET_LOGGED_USER,\n  saveLoggedUser,\n  getLoggedUser,\n} from '../actions/user';\n\n// on crée une instance d'axios\n// on va pouvoir se configurer cette instance\n// avant de s'en servir\n\nconst baseURL = 'http://denisjulien-server.eddi.cloud/projet-9-sound-clock-back/public'\n\nconst authMiddleWare = (store) => (next) => (action) => {\n  switch (action.type) {\n    case LOGIN: {\n      const { users: { email, password } } = store.getState();\n      const username = email;\n      // console.log('etape : 3 je passe par le middleware login je vais au get user : ', name, password);\n\n      // Send request with User Login for JWT Token\n      axios.post(`${baseURL}/api/login_check`, {\n        username,\n        password,\n      }).then(\n        (response) => {\n          localStorage.setItem('userToken', response.data.token);\n\n          console.log('etape : 4 réponse positive je passe au reducer');\n          const token = response.data.token;\n          let base64Url = token.split('.')[1];\n          let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n          let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n              return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n          }).join(''));\n\n          const payload =  JSON.parse(jsonPayload);\n          store.dispatch(getLoggedUser(payload.slug));   \n        },\n        ).catch(\n          (error) => console.log('Login error : ' , error),\n        );\n  \n    }\n    break;\n\n    case GET_USER_WITH_SLUG: \n\n      // console.log('Get User With slug prop passed to middleware ',action.slug);\n      // console.log('voici la route de l\\'api : ', `${baseURL}/api/user/${action.slug}`);\n      axios.get(`${baseURL}/api/user/${action.slug}`).then(\n        (response) => {\n          //console.log('je suis le response du get user with slug', response);\n          store.dispatch(saveUserWithSlug(response.data));   \n        },\n      ).catch(\n        () => console.log('Get User By Slug Error'),\n      );\n\n    break;\n    \n    //* Action Type to recover logged user from Token\n    case GET_LOGGED_USER: \n\n      // console.log('voici la route de l\\'api pour get logged user: ', `${baseURL}/api/user/${action.slug}`);\n      axios.get(`${baseURL}/api/user/${action.slug}`).then(\n        (response) => {\n          //console.log('je suis le response du get user with slug', response.data);\n          store.dispatch(saveLoggedUser(response.data));   \n        },\n      ).catch(\n        (error) => console.log('Get Logged User by Slug : error : ', error),\n      );\n      \n    break;\n    \n  default:\n    next(action);\n  }\n};\n\nexport default authMiddleWare;\n"]},"metadata":{},"sourceType":"module"}